# Netology_Diplom
Во вложении dag файл с задачами.
Весь код функций для работы с загрузкой и выгрузкой файлов написан в 2 вариантах

С загрузкой в локальное хранилище.
С загрузкой в хранилище S3, но он весь закомментарен.
Логика работы заданий
Start - Смотрим год который грузим и считаем сколько месяцев прошло с начала года. Исходя из количества месяцев запускаем проверку какие файлы уже обработаны с начала года. Создаем задание только для новых фалов у которых нет статуса успешно обработано.
copyAndTransformS3File – Загружаем отсутствующие архивные файлы с полной выгрузкой из S3 бакета и распаковываем их локально и в свой S3 бакет.
CopyToClickHouse – открываем csv файл и загружаем в таблицу ClickHouse.
MakeMetricsFromClickHouse – Делаем запросы к базе ClickHouse по перечню заданий и сохраняем в csv.
DisableTaskIfSuccess – при успешной обработке файла и выгрузки отчетов сохраняем файл с результатом выгрузки для дальнейшего исключения из обработки.
